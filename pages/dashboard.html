<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | SKILLBRIDGE INDIA</title>
    <link rel="stylesheet" href="../css/style.css">
    <!-- Chart.js for interactive visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .view-section {
            display: none;
        }

        .view-section.active {
            display: block;
            animation: fadeUp 0.5s ease;
        }
    </style>
</head>

<body style="background-color: #f1f5f9;">

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="logo" style="font-size: 1.25rem;">
                    SKILLBRIDGE <span>INDIA</span>
                </a>
                <button id="close-sidebar" class="mobile-menu-btn" style="margin-left: auto; display: none;">‚úï</button>
            </div>
            <nav class="sidebar-nav">
                <a href="#" onclick="switchView('overview')" class="sidebar-link active" id="nav-overview">
                    <span style="font-size: 1.2rem;">üìä</span> Overview
                </a>
                <a href="#" onclick="switchView('jobs')" class="sidebar-link" id="nav-jobs">
                    <span style="font-size: 1.2rem;">üîç</span> Job Intelligence
                </a>
                <a href="#" onclick="switchView('maps')" class="sidebar-link" id="nav-maps">
                    <span style="font-size: 1.2rem;">üõ£Ô∏è</span> Career Maps
                </a>
                <a href="#" onclick="switchView('learning')" class="sidebar-link" id="nav-learning">
                    <span style="font-size: 1.2rem;">üéì</span> My Learning
                </a>
                <a href="#" onclick="switchView('reports')" class="sidebar-link" id="nav-reports">
                    <span style="font-size: 1.2rem;">üìú</span> Policy Reports
                </a>
                <a href="#" onclick="switchView('settings')" class="sidebar-link" id="nav-settings">
                    <span style="font-size: 1.2rem;">‚öôÔ∏è</span> Settings
                </a>
                <div style="flex-grow: 1;"></div>
                <a href="#" onclick="api.logout()" class="sidebar-link" style="color: #ef4444; margin-top: 1rem;">
                    <span style="font-size: 1.2rem;">üö™</span> Logout
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="flex items-center gap-4">
                    <button class="mobile-menu-btn" id="open-sidebar"
                        style="font-size: 1.5rem; cursor: pointer; color: var(--primary-main);">
                        ‚ò∞
                    </button>
                    <div>
                        <h2 id="page-title" style="font-size: 1.5rem; margin: 0;">Dashboard</h2>
                        <div class="flex items-center gap-2" style="margin-top: 0.25rem;">
                            <span style="font-size: 0.8rem; color: var(--text-muted);">Target Career:</span>
                            <select id="careerSelector" onchange="changeCareer(this.value)"
                                style="border: none; background: transparent; font-weight: 600; color: var(--brand-main); cursor: pointer; font-size: 0.9rem;">
                                <option value="ds">Data Scientist</option>
                                <option value="pm">Product Manager</option>
                                <option value="cyber">Cybersecurity Analyst</option>
                                <option value="ux">UX Designer</option>
                                <option value="blockchain">Blockchain Developer</option>
                                <option value="digital">Digital Marketing Mgr</option>
                                <option value="finance">Investment Banker</option>
                                <option value="cloud">Cloud Architect</option>
                                <option value="ai-ethics">AI Ethics Specialist</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-6">
                    <!-- Notification Bell -->
                    <div style="position: relative; cursor: pointer;" onclick="toggleNotifications()">
                        <span style="font-size: 1.25rem;">üîî</span>
                        <span id="notif-badge"
                            style="position: absolute; top: -5px; right: -5px; background: var(--brand-main); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; display: flex; align-items: center; justify-content: center;">3</span>

                        <!-- Dropdown -->
                        <div id="notif-dropdown"
                            style="display: none; position: absolute; top: 150%; right: 0; width: 300px; background: white; border-radius: 12px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; z-index: 1000; overflow: hidden;">
                            <div
                                style="padding: 1rem; border-bottom: 1px solid #f1f5f9; font-weight: 600; color: var(--primary-dark);">
                                Notifications</div>
                            <div id="notif-list" style="max-height: 300px; overflow-y: auto;">
                                <!-- Items injected by JS -->
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-3">
                        <div style="text-align: right; display: none; @media(min-width: 768px){display: block;}">
                            <span id="user-greeting"
                                style="display: block; font-weight: 600; font-size: 0.9rem;">Welcome</span>
                            <span style="display: block; font-size: 0.75rem; color: var(--text-muted);">Student</span>
                        </div>
                        <!-- Profile Clickable -->
                        <div id="user-initials" onclick="switchView('settings')"
                            style="width: 42px; height: 42px; background: linear-gradient(135deg, var(--brand-main), var(--brand-dark)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; box-shadow: var(--shadow-md); cursor: pointer; transition: transform 0.2s;">
                            U</div>
                    </div>
                </div>
            </div>

            <!-- VIEW: OVERVIEW -->
            <div id="view-overview" class="view-section active">

                <!-- Metrics -->
                <div class="stat-grid-dashboard">
                    <div class="db-card animate-on-scroll" style="animation-delay: 0.1s;">
                        <div style="color: var(--brand-main); font-size: 1.5rem; margin-bottom: 0.5rem;">üéØ</div>
                        <h3>Skill Score</h3>
                        <div class="db-value">85%</div>
                        <p style="font-size: 0.85rem; color: var(--success-main);">+5% from last month</p>
                    </div>
                    <div class="db-card animate-on-scroll" style="animation-delay: 0.2s;">
                        <div style="color: var(--accent-main); font-size: 1.5rem; margin-bottom: 0.5rem;">üöÄ</div>
                        <h3>Job Matches</h3>
                        <div class="db-value" id="stat-recommendedJobs">12</div>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">Based on your profile</p>
                    </div>
                    <div class="db-card animate-on-scroll" style="animation-delay: 0.3s;">
                        <div style="color: var(--success-main); font-size: 1.5rem; margin-bottom: 0.5rem;">üéì</div>
                        <h3>Courses</h3>
                        <div class="db-value" id="stat-pendingCourses">3</div>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">In progress</p>
                    </div>
                    <div class="db-card animate-on-scroll" style="animation-delay: 0.4s;">
                        <div style="color: var(--primary-light); font-size: 1.5rem; margin-bottom: 0.5rem;">üìÖ</div>
                        <h3>Events</h3>
                        <div class="db-value" id="stat-upcomingEvents">2</div>
                        <p style="font-size: 0.85rem; color: var(--text-muted);">Upcoming webcasts</p>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-2 gap-6" style="margin-bottom: 2rem;">
                    <div class="db-card animate-on-scroll"
                        style="animation-delay: 0.5s; grid-column: span 2; @media(min-width: 1024px){grid-column: span 1;}">
                        <div class="flex justify-between items-center"
                            style="margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                            <h3 style="margin: 0;">Skill Demand Trends</h3>
                            <div class="flex gap-2">
                                <select id="chartCategory" class="form-select"
                                    style="padding: 0.25rem 0.5rem; font-size: 0.85rem; width: auto;"
                                    onchange="updateChartData()">
                                    <option value="ds">Data Science</option>
                                    <option value="web">Web Development</option>
                                    <option value="cyber">Cybersecurity</option>
                                    <option value="cloud">Cloud Computing</option>
                                    <!-- Added for Careers -->
                                    <option value="pm">Product Mgmt</option>
                                    <option value="ux">UX Design</option>
                                </select>
                                <select id="chartRegion" class="form-select"
                                    style="padding: 0.25rem 0.5rem; font-size: 0.85rem; width: auto;"
                                    onchange="updateChartData()">
                                    <option value="national">National</option>
                                    <option value="metro">Metro Cities</option>
                                    <option value="tier2">Tier-2 Cities</option>
                                </select>
                            </div>
                        </div>
                        <div style="height: 300px; width: 100%;">
                            <canvas id="skillTrendChart"></canvas>
                        </div>
                    </div>
                    <div class="db-card animate-on-scroll"
                        style="animation-delay: 0.6s; grid-column: span 2; @media(min-width: 1024px){grid-column: span 1;}">
                        <h3 style="margin-bottom: 1.5rem;">Career Readiness</h3>
                        <div style="height: 300px; width: 100%; display: flex; justify-content: center;">
                            <canvas id="readinessChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Skills & Recommendations Section -->
                <div class="grid grid-cols-2 gap-6" style="margin-bottom: 2rem;">
                    <!-- My Skills -->
                    <div class="db-card animate-on-scroll"
                        style="animation-delay: 0.8s; grid-column: span 2; @media(min-width: 1024px){grid-column: span 1;}">
                        <h3 style="margin-bottom: 1rem;">My Skills Profile</h3>
                        <div class="skill-input-group">
                            <input type="text" id="skillInput" class="form-input"
                                placeholder="Add a skill (e.g. Finance, Design)..."
                                onkeypress="handleSkillInput(event)">
                            <button class="btn btn-primary" onclick="addSkill()"
                                style="padding: 0.5rem 1rem;">Add</button>
                        </div>
                        <div id="skillContainer" class="skill-tag-container">
                            <!-- Skills will be added here -->
                        </div>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                            * Try adding: 'Marketing', 'Finance', 'Java', 'Design' to see diverse recommendations.
                        </p>
                    </div>

                    <!-- Level Up Suggestions -->
                    <div class="db-card animate-on-scroll"
                        style="animation-delay: 0.9s; grid-column: span 2; @media(min-width: 1024px){grid-column: span 1;}">
                        <div class="flex justify-between items-center" style="margin-bottom: 1rem;">
                            <h3 style="margin: 0;">Level Up Advice</h3>
                            <span id="target-role"
                                style="font-size: 0.85rem; color: var(--brand-main); font-weight: 600;">Detecting
                                Target...</span>
                        </div>
                        <div id="suggestionsList">
                            <!-- Helper Text -->
                            <p style="color: var(--text-muted); font-style: italic;">Add skills to see personalized
                                course recommendations.</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="db-card animate-on-scroll" style="animation-delay: 0.7s;">
                    <h3 style="margin-bottom: 1rem;">Recent Activity</h3>
                    <div id="activity-feed" style="display: flex; flex-direction: column; gap: 1rem;">
                        <!-- Generated by JS -->
                    </div>
                </div>
            </div>
            <!-- END VIEW: OVERVIEW -->

            <!-- VIEW: JOB INTELLIGENCE -->
            <div id="view-jobs" class="view-section">
                <div class="db-card animate-on-scroll">
                    <h3>‚ö° Active Job Market Intelligence</h3>
                    <p class="text-muted">Real-time analysis of job postings matching your profile.</p>
                    <div class="grid grid-cols-2 gap-4" style="margin-top: 2rem;" id="job-alerts-container">
                        <!-- Dynamic Job Cards -->
                    </div>
                </div>
            </div>

            <!-- VIEW: CAREER MAPS -->
            <div id="view-maps" class="view-section">
                <div class="db-card animate-on-scroll">
                    <h3>üó∫Ô∏è AI Career Roadmap</h3>
                    <p class="text-muted margin-bottom-2" id="roadmap-desc">Projected path based on current growth
                        velocity.</p>
                    <div style="position: relative; padding-left: 20px; border-left: 2px dashed #cbd5e1;"
                        id="roadmap-container">
                        <!-- Dynamic Roadmap -->
                    </div>
                </div>
            </div>

            <!-- VIEW: LEARNING -->
            <div id="view-learning" class="view-section">
                <div class="db-card animate-on-scroll">
                    <h3>üéì My Learning Journey</h3>
                    <div style="margin-top: 1.5rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <div class="flex justify-between" style="margin-bottom: 0.5rem;">
                                <strong>Advanced Python for Data Science</strong>
                                <span class="text-muted">75%</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px;">
                                <div
                                    style="width: 75%; height: 100%; background: var(--brand-main); border-radius: 4px;">
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 1.5rem;">
                            <div class="flex justify-between" style="margin-bottom: 0.5rem;">
                                <strong>Public Speaking Masterclass</strong>
                                <span class="text-muted">30%</span>
                            </div>
                            <div style="width: 100%; height: 8px; background: #e2e8f0; border-radius: 4px;">
                                <div
                                    style="width: 30%; height: 100%; background: var(--accent-main); border-radius: 4px;">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: REPORTS -->
            <div id="view-reports" class="view-section">
                <div class="db-card animate-on-scroll">
                    <h3>üìú National Policy Reports</h3>
                    <p class="text-muted">Download latest official documents and skill gap analysis.</p>
                    <div style="margin-top: 1.5rem; display: grid; gap: 1rem;">
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px;">
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <div style="font-size: 1.5rem; color: #ef4444;">üìÑ</div>
                                <div>
                                    <h5 style="margin: 0; font-size: 1rem;">National Skill Gap Report 2025</h5>
                                    <span style="font-size: 0.8rem; color: var(--text-muted);">PDF ‚Ä¢ 4.2 MB ‚Ä¢ Published
                                        Jan 2025</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Download</button>
                        </div>
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px;">
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <div style="font-size: 1.5rem; color: #ef4444;">üìÑ</div>
                                <div>
                                    <h5 style="margin: 0; font-size: 1rem;">AI Workforce Strategy</h5>
                                    <span style="font-size: 0.8rem; color: var(--text-muted);">PDF ‚Ä¢ 2.8 MB ‚Ä¢ Published
                                        Dec 2024</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Download</button>
                        </div>
                        <div
                            style="display: flex; align-items: center; justify-content: space-between; padding: 1rem; background: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px;">
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <div style="font-size: 1.5rem; color: #ef4444;">üìÑ</div>
                                <div>
                                    <h5 style="margin: 0; font-size: 1rem;">Rural Digital Literacy Audit</h5>
                                    <span style="font-size: 0.8rem; color: var(--text-muted);">PDF ‚Ä¢ 5.1 MB ‚Ä¢ Published
                                        Nov 2024</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem;">Download</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section">
                <div class="db-card animate-on-scroll">
                    <h3>‚öôÔ∏è Settings</h3>
                    <div style="margin-top: 1.5rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                            <div>
                                <h4 style="margin: 0;">Dark Mode</h4>
                                <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">Toggle application
                                    theme</p>
                            </div>
                            <label class="switch"
                                style="position: relative; display: inline-block; width: 50px; height: 26px;">
                                <input type="checkbox" id="theme-toggle" onchange="toggleTheme()">
                                <span class="slider"
                                    style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px;"></span>
                                <span class="slider-before"
                                    style="position: absolute; content: ''; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></span>
                            </label>
                            <style>
                                input:checked+.slider {
                                    background-color: var(--brand-main);
                                }

                                input:checked+.slider .slider-before {
                                    transform: translateX(24px);
                                }

                                /* Attempting a simple CSS toggle here, but JS will handle class */
                                /* Fix for pseudo element not working inline */
                                input:checked+.slider::before {
                                    position: absolute;
                                    content: "";
                                    height: 20px;
                                    width: 20px;
                                    left: 3px;
                                    bottom: 3px;
                                    background-color: white;
                                    transition: .4s;
                                    border-radius: 50%;
                                    transform: translateX(24px);
                                }

                                .slider::before {
                                    position: absolute;
                                    content: "";
                                    height: 20px;
                                    width: 20px;
                                    left: 3px;
                                    bottom: 3px;
                                    background-color: white;
                                    transition: .4s;
                                    border-radius: 50%;
                                }
                            </style>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem;">
                            <h4 style="margin-bottom: 0.5rem;">Account Privacy</h4>
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <span class="text-muted">Public Profile</span>
                                <input type="checkbox" checked>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- CHATBOT WIDGET -->
    <div class="chatbot-fab" onclick="toggleChat()">
        üí¨
    </div>

    <div class="chatbot-window" id="chatbot">
        <div class="chat-header">
            <div>
                <strong style="display: block;">Career Coach AI</strong>
                <span style="font-size: 0.75rem; opacity: 0.9;" id="bot-status">Targeting: Data Scientist</span>
            </div>
            <button onclick="toggleChat()"
                style="background:none; border:none; color:white; font-size:1.2rem; cursor:pointer;">&times;</button>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-bubble bot">Hello! I'm your AI career coach. How can I help you reach your goals?</div>
            <div class="chat-bubble bot" style="animation-delay: 0.1s;">Try asking about "salary", "skills", or
                "roadmap".</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="Ask anything (e.g. 'What is the salary?')..."
                onkeypress="handleChatKey(event)">
            <button onclick="sendMessage()">‚û§</button>
        </div>
    </div>

    <!-- Fixed Badge -->
    <div class="designed-by">
        Designed By <span>CodeCrafters</span>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/main.js"></script>
    <script>
        // Check Auth and Load User
        const user = api.requireAuth();
        if (user) {
            document.getElementById('user-greeting').textContent = `Welcome, ${user.name.split(' ')[0]}`;
            const initials = user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            document.getElementById('user-initials').textContent = initials;
        }

        // Theme Logic
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // Init Theme
        if (localStorage.getItem('theme') === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').checked = true;
        }

        // SPA Navigation Logic
        function switchView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewName}`).classList.add('active');

            document.querySelectorAll('.sidebar-link').forEach(el => el.classList.remove('active'));
            // Helper for Reports/Settings which might not have active states in CSS originally
            const navItem = document.getElementById(`nav-${viewName}`);
            if (navItem) navItem.classList.add('active');

            const titles = {
                'overview': 'Dashboard',
                'jobs': 'Job Intelligence',
                'maps': 'Career Roadmap',
                'learning': 'My Learning',
                'reports': 'Policy Reports',
                'settings': 'Settings'
            };
            document.getElementById('page-title').textContent = titles[viewName] || 'Dashboard';
        }


        const sidebar = document.getElementById('sidebar');
        const openBtn = document.getElementById('open-sidebar');
        const closeBtn = document.getElementById('close-sidebar');
        function toggleSidebar() { sidebar.classList.toggle('active'); }
        openBtn.addEventListener('click', toggleSidebar);
        closeBtn.addEventListener('click', toggleSidebar);

        // Chart & Data Logic (Overview)
        let skillChart;
        const chartData = {
            'ds': { label: 'Data Science Demand', data: [65, 72, 78, 85, 90, 95] },
            'web': { label: 'Web Dev Demand', data: [80, 82, 85, 88, 85, 89] },
            'cyber': { label: 'Cybersecurity Demand', data: [50, 55, 65, 75, 88, 98] },
            'cloud': { label: 'Cloud Computing Demand', data: [60, 68, 75, 82, 92, 96] },
            'pm': { label: 'Product Mgmt Demand', data: [70, 75, 76, 78, 85, 92] },
            'ux': { label: 'UX Design Demand', data: [55, 60, 68, 72, 80, 85] }
        };

        function updateChartData() {
            const cat = document.getElementById('chartCategory').value;
            const region = document.getElementById('chartRegion').value;
            const baseData = chartData[cat] || chartData['ds'];
            let displayData = [...baseData.data];
            if (region === 'metro') displayData = displayData.map(v => Math.min(100, v + 5));
            if (region === 'tier2') displayData = displayData.map(v => Math.max(10, v - 10));
            skillChart.data.datasets[0].label = baseData.label;
            skillChart.data.datasets[0].data = displayData;
            skillChart.update();
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Init Chart
            const ctx1 = document.getElementById('skillTrendChart').getContext('2d');
            skillChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Data Science Demand', data: [65, 72, 78, 85, 90, 95],
                        borderColor: '#2563eb', backgroundColor: 'rgba(37, 99, 235, 0.1)', fill: true, tension: 0.4
                    }, {
                        label: 'Your Skill Growth', data: [40, 45, 55, 65, 75, 85],
                        borderColor: '#059669', backgroundColor: 'transparent', borderDash: [5, 5], tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true, grid: { color: '#f1f5f9' } }, x: { grid: { display: false } } } }
            });

            const ctx2 = document.getElementById('readinessChart').getContext('2d');
            new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Technical', 'Soft Skills', 'Exp', 'Certs'],
                    datasets: [{ data: [85, 70, 60, 90], backgroundColor: ['#2563eb', '#60a5fa', '#059669', '#d97706'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, cutout: '70%' }
            });

            generateActivityFeed();
            // Trigger initial career
            changeCareer('ds');
        });

        // Skill System
        const skills = ['Data Analysis', 'Excel'];
        const skillContainer = document.getElementById('skillContainer');
        const skillInput = document.getElementById('skillInput');

        // MASSIVE Skill Database
        const skillDatabase = {
            'python': { title: 'Machine Learning A-Z', why: 'Essential for AI/ML roles.', youtube: 'Complete Machine Learning Course' },
            'java': { title: 'Spring Boot Framework', why: 'Standard for Enterprise Backend.', youtube: 'Spring Boot Full Course' },
            'javascript': { title: 'React JS / Next.js', why: 'Top Frontend Framework.', youtube: 'React JS full course' },
            'react': { title: 'Redux State Management', why: 'Manage complex UI states.', youtube: 'Redux tutorial' },
            'html': { title: 'Modern CSS & Flexbox', why: 'Create responsive layouts.', youtube: 'CSS Flexbox tutorial' },
            'css': { title: 'JavaScript ES6+', why: 'Add interactivity to web pages.', youtube: 'JavaScript full course' },
            'node': { title: 'Express.js & MongoDB', why: 'Full Stack capabilities.', youtube: 'MERN stack tutorial' },
            'sql': { title: 'Database Normalization', why: 'Design efficient databases.', youtube: 'SQL database design' },
            'finance': { title: 'Financial Modeling', why: 'Build robust valuation models.', youtube: 'Financial Modeling Course' },
            'accounting': { title: 'US GAAP Principles', why: 'International standard compliance.', youtube: 'US GAAP Accounting' },
            'excel': { title: 'VBA & Macros', why: 'Automate repetitive spreadsheet tasks.', youtube: 'Excel VBA Tutorial' },
            'marketing': { title: 'Google Analytics 4', why: 'Track campaign performance.', youtube: 'Google Analytics 4 Tutorial' },
            'seo': { title: 'Content Strategy', why: 'Drive organic traffic.', youtube: 'SEO Content Strategy' },
            'social media': { title: 'Paid Ad Campaigns', why: 'Maximize ROI on ads.', youtube: 'Facebook Ads Tutorial' },
            'design': { title: 'Figma Mastery', why: 'Industry standard for UI design.', youtube: 'Figma UI Design Tutorial' },
            'photoshop': { title: 'Digital Illustration', why: 'Expand your creative asset creation.', youtube: 'Digital painting tutorial' },
            'communication': { title: 'Public Speaking', why: 'Lead meetings with confidence.', youtube: 'Public Speaking Masterclass' },
            'leadership': { title: 'Conflict Resolution', why: 'Manage team dynamics.', youtube: 'Conflict Resolution Strategies' },
            'management': { title: 'Agile/Scrum', why: 'Modern project management.', youtube: 'Agile Scrum Full Course' },
        };

        function renderSkills() {
            skillContainer.innerHTML = '';
            skills.forEach((skill, index) => {
                const tag = document.createElement('div');
                tag.className = 'skill-tag';
                tag.innerHTML = `${skill} <span class="remove-skill" onclick="removeSkill(${index})">&times;</span>`;
                skillContainer.appendChild(tag);
            });
            updateSuggestions();
        }

        function addSkill() {
            const val = skillInput.value.trim();
            if (val && !skills.includes(val)) {
                skills.push(val);
                skillInput.value = '';
                renderSkills();
            }
        }
        function handleSkillInput(e) { if (e.key === 'Enter') addSkill(); }
        function removeSkill(index) { skills.splice(index, 1); renderSkills(); }

        function updateSuggestions() {
            const list = document.getElementById('suggestionsList');
            const targetRole = document.getElementById('target-role');
            let recs = [];

            const lowerSkills = skills.map(s => s.toLowerCase());

            // Determine Role Context
            // (Note: This is partially overridden by Global Career Selector, used for fallbacks)

            lowerSkills.forEach(s => {
                Object.keys(skillDatabase).forEach(dbKey => {
                    if (s.includes(dbKey) || dbKey.includes(s)) {
                        const rec = skillDatabase[dbKey];
                        if (!recs.find(r => r.title === rec.title)) recs.push(rec);
                    }
                });
            });

            if (recs.length === 0) {
                recs.push(skillDatabase['management']);
                recs.push(skillDatabase['communication']);
            }
            const displayRecs = recs.slice(0, 4);

            list.innerHTML = displayRecs.map(rec => `
                <div class="level-up-card">
                    <div style="display:flex; justify-content:space-between;">
                        <h4 style="font-size: 1rem; margin-bottom: 0.25rem;">${rec.title}</h4>
                        <span style="font-size:1.2rem; color: #ff0000;">‚ñ∂</span>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">${rec.why}</p>
                    <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(rec.youtube)}" target="_blank" 
                       style="font-size: 0.8rem; color: var(--brand-main); font-weight: 600; text-decoration: none; display: flex; align-items: center; gap: 0.25rem;">
                       Watch Free Course on YouTube &rarr;
                    </a>
                </div>
            `).join('');
        }

        function generateActivityFeed() {
            const activities = [
                { text: 'Applied for Senior Analyst at TechCorp', time: '2 mins ago', color: '#2563eb' },
                { text: 'Completed "Python Basics" Module', time: '1 hour ago', color: '#059669' },
                { text: 'Updated Career Roadmap Profile', time: 'Yesterday', color: '#d97706' },
                { text: 'Received Badge: "Data Explorer"', time: '2 days ago', color: '#9333ea' },
                { text: 'Viewed course "Advanced Excel"', time: '3 days ago', color: '#2563eb' }
            ];
            const feed = document.getElementById('activity-feed');
            feed.innerHTML = activities.map(act => `
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: #f8fafc; border-radius: 8px;">
                    <div style="width: 8px; height: 8px; border-radius: 50%; background: ${act.color};"></div>
                    <div>
                        <p style="font-weight: 600; margin-bottom: 0.25rem;">${act.text}</p>
                        <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">${act.time}</p>
                    </div>
                </div>
            `).join('');
        }

        // ==========================================
        // CAREER PERSONALIZATION & CHATBOT LOGIC
        // ==========================================
        let currentCareer = 'ds';
        const careerConfigs = {
            'ds': {
                title: 'Data Scientist',
                jobs: [
                    { t: 'Senior Data Scientist', c: 'Google India', m: '98%', posted: '2 days ago', skills: 'Python, TensorFlow', pay: '‚Çπ35L' },
                    { t: 'AI Researcher', c: 'Microsoft', m: '94%', posted: '5 days ago', skills: 'PyTorch, NLP', pay: '‚Çπ45L' },
                    { t: 'Data Analyst Lead', c: 'Flipkart', m: '88%', posted: '1 week ago', skills: 'SQL, Tableau', pay: '‚Çπ28L' }
                ],
                roadmap: [
                    { t: 'Junior Analyst', y: '2024 (Current)', c: '#059669', cert: 'Google Data Analytics' },
                    { t: 'ML Engineer', y: '2025', c: '#2563eb', cert: 'AWS Machine Learning' },
                    { t: 'Principal Data Scientist', y: '2027', c: '#0f172a', cert: 'PhD / Advanced Research' }
                ],
                salary: '‚Çπ12 - ‚Çπ50 LPA'
            },
            'pm': {
                title: 'Product Manager',
                jobs: [
                    { t: 'Product Owner', c: 'Flipkart', m: '95%', posted: '1 day ago', skills: 'Agile, JIRA', pay: '‚Çπ32L' },
                    { t: 'APM', c: 'Uber', m: '90%', posted: '3 days ago', skills: 'Analytics, UX', pay: '‚Çπ24L' }
                ],
                roadmap: [
                    { t: 'Business Analyst', y: '2024 (Current)', c: '#059669', cert: 'CSM (Scrum Master)' },
                    { t: 'Product Manager', y: '2025', c: '#2563eb', cert: 'Reforge Product Strategy' },
                    { t: 'VP of Product', y: '2028', c: '#0f172a', cert: 'MBA' }
                ],
                salary: '‚Çπ15 - ‚Çπ45 LPA'
            },
            'cyber': {
                title: 'Cybersecurity Analyst',
                jobs: [
                    { t: 'Security Engineer', c: 'Cisco', m: '96%', posted: 'Just now', skills: 'Network Sec, Python', pay: '‚Çπ22L' },
                    { t: 'SOC Analyst', c: 'Palo Alto', m: '92%', posted: '4 days ago', skills: 'SIEM, Splunk', pay: '‚Çπ18L' }
                ],
                roadmap: [
                    { t: 'Network Admin', y: '2024 (Current)', c: '#059669', cert: 'CompTIA Security+' },
                    { t: 'Ethical Hacker', y: '2025', c: '#2563eb', cert: 'CEH / OSCP' },
                    { t: 'CISO', y: '2029', c: '#0f172a', cert: 'CISSP' }
                ],
                salary: '‚Çπ10 - ‚Çπ35 LPA'
            },
            'ux': {
                title: 'UX Designer',
                jobs: [
                    { t: 'Senior Product Designer', c: 'Cred', m: '97%', posted: '2 days ago', skills: 'Figma, Prototyping', pay: '‚Çπ28L' },
                    { t: 'UX Researcher', c: 'Swiggy', m: '93%', posted: '1 week ago', skills: 'User Testing', pay: '‚Çπ20L' }
                ],
                roadmap: [
                    { t: 'UI Designer', y: '2024 (Current)', c: '#059669', cert: 'Google UX Design' },
                    { t: 'Senior UX Designer', y: '2025', c: '#2563eb', cert: 'NN/g Certification' },
                    { t: 'Head of Design', y: '2028', c: '#0f172a', cert: 'Design Leadership' }
                ],
                salary: '‚Çπ8 - ‚Çπ30 LPA'
            },
            'blockchain': {
                title: 'Blockchain Developer',
                jobs: [
                    { t: 'Smart Contract Dev', c: 'Polygon', m: '95%', posted: '1 day ago', skills: 'Solidity, Rust', pay: '‚Çπ40L' },
                    { t: 'Web3 Engineer', c: 'Coinbase', m: '91%', posted: '3 days ago', skills: 'React, Ethers.js', pay: '‚Çπ35L' }
                ],
                roadmap: [
                    { t: 'Backend Dev', y: '2024 (Current)', c: '#059669', cert: 'Java/Node.js' },
                    { t: 'Smart Contract Engineer', y: '2025', c: '#2563eb', cert: 'Certified Blockchain Dev' },
                    { t: 'Lead Blockchain Architect', y: '2027', c: '#0f172a', cert: 'System Arch' }
                ],
                salary: '‚Çπ18 - ‚Çπ60 LPA'
            },
            'digital': {
                title: 'Digital Marketing Mgr',
                jobs: [
                    { t: 'Growth Hacker', c: 'Zomato', m: '94%', posted: '6 hours ago', skills: 'SEO, Analytics', pay: '‚Çπ25L' },
                    { t: 'Performance Marketer', c: 'Nykaa', m: '89%', posted: '2 days ago', skills: 'Facebook Ads', pay: '‚Çπ18L' }
                ],
                roadmap: [
                    { t: 'Social Media Exec', y: '2024 (Current)', c: '#059669', cert: 'HubSpot Inbound' },
                    { t: 'Performance Manager', y: '2025', c: '#2563eb', cert: 'Google Ads' },
                    { t: 'CMO', y: '2029', c: '#0f172a', cert: 'Marketing Strategy' }
                ],
                salary: '‚Çπ10 - ‚Çπ35 LPA'
            },
            'finance': {
                title: 'Investment Banker',
                jobs: [
                    { t: 'Investment Analyst', c: 'JP Morgan', m: '98%', posted: '1 day ago', skills: 'Modeling, Excel', pay: '‚Çπ30L' },
                    { t: 'Associate', c: 'Goldman Sachs', m: '95%', posted: '4 days ago', skills: 'Valuation, M&A', pay: '‚Çπ45L' }
                ],
                roadmap: [
                    { t: 'Financial Analyst', y: '2024 (Current)', c: '#059669', cert: 'CFA Level 1' },
                    { t: 'Associate', y: '2026', c: '#2563eb', cert: 'CFA Level 3' },
                    { t: 'Managing Director', y: '2030', c: '#0f172a', cert: 'MBA Finance' }
                ],
                salary: '‚Çπ20 - ‚Çπ80 LPA'
            },
            'cloud': {
                title: 'Cloud Architect',
                jobs: [
                    { t: 'Cloud Engineer', c: 'Amazon AWS', m: '96%', posted: '12 hours ago', skills: 'AWS, Terraform', pay: '‚Çπ35L' },
                    { t: 'Solutions Architect', c: 'Google Cloud', m: '93%', posted: '3 days ago', skills: 'GCP, Kubernetes', pay: '‚Çπ42L' }
                ],
                roadmap: [
                    { t: 'DevOps Engineer', y: '2024 (Current)', c: '#059669', cert: 'AWS Solutions Arch' },
                    { t: 'Senior Cloud Architect', y: '2026', c: '#2563eb', cert: 'CKA (Kubernetes)' },
                    { t: 'CTO', y: '2029', c: '#0f172a', cert: 'Leadership' }
                ],
                salary: '‚Çπ25 - ‚Çπ70 LPA'
            },
            'ai-ethics': {
                title: 'AI Ethics Specialist',
                jobs: [
                    { t: 'Responsible AI Lead', c: 'Accenture', m: '92%', posted: '1 week ago', skills: 'Policy, Bias Audit', pay: '‚Çπ28L' },
                    { t: 'AI Governance Analyst', c: 'NITI Aayog', m: '88%', posted: '5 days ago', skills: 'Regulation, Law', pay: '‚Çπ22L' }
                ],
                roadmap: [
                    { t: 'Policy Analyst', y: '2024 (Current)', c: '#059669', cert: 'Data Privacy' },
                    { t: 'AI Ethics Officer', y: '2026', c: '#2563eb', cert: 'AI Governance' },
                    { t: 'Chief Ethics Officer', y: '2030', c: '#0f172a', cert: 'PhD' }
                ],
                salary: '‚Çπ15 - ‚Çπ40 LPA'
            }
        };

        function changeCareer(role) {
            currentCareer = role;
            const config = careerConfigs[role];

            // Personalize UI
            document.getElementById('bot-status').innerText = `Targeting: ${config.title}`;
            document.getElementById('target-role').innerText = `Target: ${config.title}`;

            // Personalize Charts (Simulated map)
            const map = { 'ds': 'ds', 'pm': 'pm', 'cyber': 'cyber', 'ux': 'ux', 'blockchain': 'ds', 'digital': 'pm', 'finance': 'ds', 'cloud': 'cloud', 'ai-ethics': 'pm' };
            document.getElementById('chartCategory').value = map[role] || 'ds';
            if (window.updateChartData) updateChartData();

            // Personalize Job View (Detailed)
            const jobContainer = document.getElementById('job-alerts-container');
            if (jobContainer) {
                jobContainer.innerHTML = config.jobs.map(j => `
                    <div class="db-card" style="border-left: 4px solid var(--brand-main);">
                        <div class="flex justify-between">
                            <h4>${j.t}</h4>
                            <span class="skill-tag" style="background: var(--success-light); color: var(--success-main);">${j.m} Match</span>
                        </div>
                        <p class="text-muted" style="margin-bottom: 0.5rem;">${j.c} ‚Ä¢ <span style="font-size: 0.8rem;">${j.posted}</span></p>
                        <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem;">
                            <strong>Skills:</strong> ${j.skills}
                        </div>
                         <div style="font-size: 0.85rem; font-weight: 600; color: var(--brand-dark); margin-bottom: 1rem;">
                            Est. Pay: ${j.pay}
                        </div>
                        <button class="btn btn-secondary" style="width: 100%;">Apply Now</button>
                    </div>
                `).join('');
            }

            // Personalize Roadmap View (Detailed)
            const roadContainer = document.getElementById('roadmap-container');
            if (roadContainer) {
                roadContainer.innerHTML = config.roadmap.map(r => `
                    <div style="position: relative; margin-bottom: 2rem;">
                        <div style="position: absolute; left: -26px; top: 0; width: 14px; height: 14px; background: ${r.c}; border-radius: 50%;"></div>
                        <h4>${r.t}</h4>
                        <p class="text-muted" style="margin-bottom: 0.25rem;">${r.y}</p>
                        <div class="skill-tag" style="display: inline-block; font-size: 0.75rem;">Cert: ${r.cert}</div>
                    </div>
                `).join('');
            }
        }

        // Chatbot Functionality
        function toggleChat() {
            document.getElementById('chatbot').classList.toggle('active');
        }

        function handleChatKey(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const container = document.getElementById('chat-messages');
            const text = input.value.trim();
            if (!text) return;

            // User Message
            const userBubble = document.createElement('div');
            userBubble.className = 'chat-bubble user';
            userBubble.innerText = text;
            container.appendChild(userBubble);

            input.value = '';
            container.scrollTop = container.scrollHeight;

            // AI Response (Simulated)
            setTimeout(() => {
                const aiBubble = document.createElement('div');
                aiBubble.className = 'chat-bubble bot';
                aiBubble.innerText = getAIResponse(text);
                container.appendChild(aiBubble);
                container.scrollTop = container.scrollHeight;
            }, 600);
        }

        function getAIResponse(text) {
            text = text.toLowerCase();
            const config = careerConfigs[currentCareer];

            if (text.includes('salary') || text.includes('pay')) {
                return `For a ${config.title}, the typical salary range in India is ${config.salary}.`;
            }
            if (text.includes('skills') || text.includes('learn')) {
                return `To become a great ${config.title}, focus on these skills: ${currentCareer === 'ds' ? 'Python, SQL, Machine Learning' : currentCareer === 'pm' ? 'Agile, Communication, Analytics' : 'Core domain knowledge'}.`;
            }
            if (text.includes('roadmap') || text.includes('path') || text.includes('future')) {
                switchView('maps');
                return `I've opened the connection to the Career Maps view. As a ${config.title}, your path involves moving to Senior roles within 2-3 years.`;
            }
            if (text.includes('hello') || text.includes('hi')) {
                return `Hi there! I'm here to help you become a successful ${config.title}. Ask me about salary, skills, or your roadmap!`;
            }
            return `That's a great question about being a ${config.title}. I'd recommend checking the "Job Intelligence" tab for live requirements, or ask me about "salary" or "skills".`;
        }

    </script>
</body>

</html>